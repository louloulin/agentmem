/*
 * Copyright (c) AgentMem Team 2024. All rights reserved.
 */

/**
 * @file
 * AgentMem ä»“é¢‰ SDK ä½¿ç”¨ç¤ºä¾‹
 * 
 * è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨AgentMemé™æ€åº“è¿›è¡Œæ™ºèƒ½è®°å¿†ç®¡ç†ã€‚
 */

package agentmem_example

import agentmem.*

main() {
    println("ğŸš€ AgentMem ä»“é¢‰ SDK ä½¿ç”¨ç¤ºä¾‹")
    println("=" * 50)
    
    // ç¤ºä¾‹1ï¼šåŸºæœ¬è®°å¿†æ“ä½œ
    basicMemoryExample()
    
    // ç¤ºä¾‹2ï¼šå®¢æˆ·ç«¯ä½¿ç”¨
    clientExample()
    
    // ç¤ºä¾‹3ï¼šæœç´¢åŠŸèƒ½
    searchExample()
    
    // ç¤ºä¾‹4ï¼šé”™è¯¯å¤„ç†
    errorHandlingExample()
    
    println("\nğŸ‰ æ‰€æœ‰ç¤ºä¾‹è¿è¡Œå®Œæˆï¼")
}

/// åŸºæœ¬è®°å¿†æ“ä½œç¤ºä¾‹
func basicMemoryExample(): Unit {
    println("\nğŸ“š åŸºæœ¬è®°å¿†æ“ä½œç¤ºä¾‹")
    println("-" * 30)
    
    // åˆ›å»ºè®°å¿†
    let memory = Memory(
        "example-001",
        "agent-demo",
        None,
        MemoryType.Semantic,
        "è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨AgentMemåº“çš„ç¤ºä¾‹è®°å¿†",
        ImportanceLevel.Medium.toFloat32(),
        None,
        1640995200000,
        1640995200000,
        0,
        None,
        SimpleMap(),
        1
    )
    
    println("âœ“ è®°å¿†åˆ›å»ºæˆåŠŸ")
    println("  ID: ${memory.id}")
    println("  å†…å®¹: ${memory.content}")
    println("  ç±»å‹: ${memory.memoryType.toString()}")
    println("  é‡è¦æ€§: ${memory.importance}")
    
    // éªŒè¯è®°å¿†
    let validateResult = memory.validate()
    match (validateResult) {
        case Ok(isValid) =>
            if (isValid) {
                println("âœ“ è®°å¿†éªŒè¯é€šè¿‡")
            } else {
                println("âŒ è®°å¿†éªŒè¯å¤±è´¥")
            }
        case Err(error) => println("âŒ è®°å¿†éªŒè¯é”™è¯¯: ${error.getMessage()}")
    }
}

/// å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹
func clientExample(): Unit {
    println("\nğŸ”Œ å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹")
    println("-" * 30)
    
    // åˆ›å»ºå®¢æˆ·ç«¯é…ç½®
    let config = ClientConfig("http://localhost:8080", "demo-agent")

    // æ„å»ºå®¢æˆ·ç«¯
    let clientResult = AgentMemClientBuilder().build()
    
    match (clientResult) {
        case Ok(client) =>
            println("âœ“ å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ")
            println("  æœåŠ¡å™¨: ${config.serverUrl}")
            println("  è¶…æ—¶: ${config.timeout}ms")

            // æ¼”ç¤ºæ·»åŠ è®°å¿†
            let memory = Memory(
                "client-example-001",
                "demo-agent",
                None,
                MemoryType.Episodic,
                "é€šè¿‡å®¢æˆ·ç«¯æ·»åŠ çš„è®°å¿†",
                ImportanceLevel.High.toFloat32(),
                None,
                1640995200000,
                1640995200000,
                0,
                None,
                SimpleMap(),
                1
            )

            let addResult = client.addMemory(memory)
            match (addResult) {
                case Ok(id) => println("âœ“ è®°å¿†æ·»åŠ æˆåŠŸ: ${id}")
                case Err(error) => println("âš  è®°å¿†æ·»åŠ å¤±è´¥: ${error.getMessage()}")
            }
        case Err(error) =>
            println("âŒ å®¢æˆ·ç«¯åˆ›å»ºå¤±è´¥: ${error.getMessage()}")
    }
}

/// æœç´¢åŠŸèƒ½ç¤ºä¾‹
func searchExample(): Unit {
    println("\nğŸ” æœç´¢åŠŸèƒ½ç¤ºä¾‹")
    println("-" * 30)
    
    // åˆ›å»ºæœç´¢æœåŠ¡
    let searchService = AgentMemSearchService("demo-agent")
    
    // æ‰§è¡Œæ–‡æœ¬æœç´¢
    let searchResult = searchService.searchByText("ç¤ºä¾‹", None, None)
    match (searchResult) {
        case Ok(results) =>
            println("âœ“ æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${results.totalCount} ä¸ªç»“æœ")
            for (result in results.results) {
                println("  - ${result.memory.content} (åˆ†æ•°: ${result.score})")
            }
        case Err(error) =>
            println("âŒ æœç´¢å¤±è´¥: ${error.getMessage()}")
    }
}

/// é”™è¯¯å¤„ç†ç¤ºä¾‹
func errorHandlingExample(): Unit {
    println("\nâŒ é”™è¯¯å¤„ç†ç¤ºä¾‹")
    println("-" * 30)
    
    // æ¼”ç¤ºä¸åŒç±»å‹çš„é”™è¯¯
    let errors = Array<AgentMemError>(4, { i =>
        match (i) {
            case 0 => AgentMemError.NetworkError("ç½‘ç»œè¿æ¥è¶…æ—¶")
            case 1 => AgentMemError.InvalidParameter("å‚æ•°ä¸èƒ½ä¸ºç©º")
            case 2 => AgentMemError.NotFound("è®°å¿†ä¸å­˜åœ¨")
            case _ => AgentMemError.InternalError("å†…éƒ¨æœåŠ¡é”™è¯¯")
        }
    })
    
    for (error in errors) {
        println("é”™è¯¯ç±»å‹: ${error.getMessage()}")
        println("é”™è¯¯ä»£ç : ${error.getErrorCode()}")
        println("å¯é‡è¯•: ${if (error.isRetryable()) { "æ˜¯" } else { "å¦" }}")
        println()
    }
}
